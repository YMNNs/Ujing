!function(e,t){!function(e,t){"use strict";t.dagger=t.dagger||e.module("dagger",["ionic"]),dagger.factory("$daggerSearch",["$compile","$rootScope","$animate","$ionicTemplateLoader","$q","$timeout",function(t,n,c,o,i,a){function r(r){function l(e){return e.templateUrl?o.load(e.templateUrl):i.when(e.template)}if(!p.shown)return p.shown=!0,p.scope=r&&r.scope||n.$new(),p.scope.onClick=function(){p.scope.searchText="",s()},p.scope.onSearch=function(e){p.scope.submitted=!0,p.scope.historyList.indexOf(e)==-1&&(p.scope.historyList.unshift(e),p.scope.historyList.length>(r.maxHistory||5)&&p.scope.historyList.pop()),u(r.id,p.scope.historyList),r.onSearch(e)},p.scope.selectHistory=function(e){p.scope.searchText=e,a(function(){p.scope.onSearch(e)})},p.scope.clearHistory=function(){d(r.id),p.scope.historyList=[]},p.scope.onChange=function(){p.scope.submitted=!1},h(r.id).then(function(e){p.scope.historyList=e}),l(r).then(function(n){return r=e.extend({},{onSearch:e.noop},r),p.tmpl=t('<div class="dag-search-view"><dag-search class="bar bar-header" search-text="searchText" button-label="'+(r.buttonLabel||"")+'" placeholder="'+(r.placeholder||"")+'" on-click="onClick()" on-search="onSearch($text)" on-change="onChange()"></dag-search><ion-content class="has-header"><div class="list search-history" ng-if="!searchText">   <div class="item" ng-repeat="item in historyList" ng-click="selectHistory(item)">{{item}}</div>   <button class="button button-clear button-full" ng-click="clearHistory()" ng-if="historyList.length > 0">清除历史记录</button></div></ion-content><div class="search-result-view" ng-if="searchText">'+n+"</div></div>"),p.element=p.tmpl(p.scope),c.addClass(".view-container","blur-hide"),c.enter(p.element,"body")})}function s(){return p.shown=!1,c.removeClass(".view-container","blur-hide"),c.leave(p.element)}function l(e){p.scope&&p.scope.onSearch(e)}function h(t){return i.when(localStorage.getItem(t)).then(function(t){return t?e.fromJson(t):[]})}function u(t,n){t&&localStorage.setItem(t,e.toJson(n))}function d(e){localStorage.removeItem(e)}var p=this;return this.shown=!1,{show:r,hide:s,search:l,getHistory:h,clearHistory:d}}]),dagger.directive("dagSearch",["$timeout",function(e){return{restrict:"EA",scope:{searchText:"=",buttonLabel:"@",placeholder:"@",onClick:"&",onSearch:"&",onChange:"&"},replace:!0,templateUrl:"dagger/template/daggersearch.html",link:function(t,n){function c(){e(function(){o.focus(),t.$evalAsync()})}var o=n.find("#search-input");t.click=function(e){t.onClick.call(t,{$event:e})},t.clear=function(){t.searchText=""},t.submit=function(e){e.$valid&&(t.onSearch.call(t,{$text:t.searchText}),o.blur())},t.$watch("searchText",function(e,n){t.onChange.call(t,{newText:e,oldText:n})});var i=n.find("#hackbtn");i.on("click",function(){c()}),i.click()}}}]),dagger.run(["$templateCache",function(e){e.put("dagger/template/daggersearch.html",'<form class="item-input-inset" name="searchForm" ng-submit="submit(searchForm)" action="javascript:void(0);">   <div class="item-input-wrapper" style="margin: 0 !important;">       <i class="icon ion-ios-search-strong placeholder-icon"></i>       <input id="search-input" type="search" name="search" placeholder="{{placeholder || \'搜索\'}}" ng-model="searchText" required>       <a class="clear icon ion-close-circled" ng-click="clear()"></a>   </div>   <a class="button button-small button-clear" ng-click="click($event)">       {{buttonLabel || \'取消\'}}   </a><a style="display: block;" id="hackbtn"></a></form>')}])}(angular,window),t[""]=e}({},function(){return this}());
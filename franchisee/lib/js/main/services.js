!function(e,t){define(["angular","collide","ionic","ionic_angular"],function(e,t){"use strict";e.module("mApp.services",["ionic"]).service("baseService",["$http","$q","$rootScope","$ionicHistory","$timeout","$log",function(t,n,i,r,o,a){var c={};i._cancelRequest=[],i.$on("$stateChangeStart",function(){o(function(){r.backView()||(e.forEach(i._cancelRequest,function(e,t){e.resolve("State change, cancel running request --> defer:"+t),a.debug("State change, cancel running request --> defer:"+t)}),i._cancelRequest=[])},0)}),i.cancel=function(e){i._cancelRequest.splice(i._cancelRequest.indexOf(e),1),e=null};var s={getData:function(r){var o=(new Date).getTime(),c=n.defer();return a.debug("request --> ",r),i._cancelRequest.push(c),e.extend(r,{timeout:c.promise}),t(r).success(function(){a.debug("Request complete in "+((new Date).getTime()-o)+"ms",r.url),i.cancel(c)}).error(function(){a.error("Request error",r),i.cancel(c)})},getJsonData:function(e,t,n){var i=n||{};return i.url=e,i.params=t,i.method="JSON",s.getData(i)},getDataByGet:function(e,t,n){var i=n||{};return i.url=e,i.params=t,i.method="GET",s.getData(i)},getJsonPData:function(e,t,n){var i=n||{},r=t;return i.hasOwnProperty("customCallback")?(r[i.customCallback]="JSON_CALLBACK",delete i.customCallback):r.jsonpcallback="JSON_CALLBACK",i.url=e,i.params=r,i.method="JSONP",s.getData(i)},postJsonData:function(n,i,r){var o=r||{};return o=e.extend({headers:{"Content-Type":void 0},transformRequest:e.identity},o),t.post(n,i,o)},seriesParams:function(t){var n="";return e.forEach(t,function(e,t){var i=t+"="+e;n&&(i="&"+i),n+=i}),n},postFormDataByPayload:function(n,i,r){var o="",a=r||{};return o=s.seriesParams(i),a=e.extend({headers:{"Cache-Control":"no-cache","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Pragma:"no-cache"},transformRequest:e.identity},a),t.post(n,o,a)},items:{set:function(e,t,n){c[e]||(c[e]={});var i=c[e];t&&(n?i[t]=n:delete i[t])},get:function(e,t){if(c[e])return c[e][t]},del:function(e,t){t?c[e]&&delete c[e][t]:c[e]&&delete c[e]}},adjustLang:function(e,t){window.IS_LOADED_LANGUAGE="undefined"!=typeof window.IS_LOADED_LANGUAGE&&window.IS_LOADED_LANGUAGE;var n=CONFIGURATION.LANGUAGES,i=CONFIGURATION.DEFAULT_LANGUAGE,r="lang_"+CONFIGURATION.PROJECT_NAME,o=window.localStorage;n&&"undefined"!=typeof t&&(window.IS_LOADED_LANGUAGE||!o||o.getItem(r)||(e.language().then(function(e){e.language?(i=e.language,o.setItem(r,i),a.debug("get "+i+" language from platform."),t.use(i).then(function(e){a.debug("change language : "+e)},function(e){a.debug("failed to change language : "+e)})):a.debug("failed to get language from platform. no language feedback.")},function(e){a.debug("failed to get language from platform."),a.debug(e)}),window.IS_LOADED_LANGUAGE=!0))}};return s}]).service("cHttpService",["baseService","widgetFactory","$q","log",function(t,n,i,r){var o=CONFIGURATION.com.midea.methods,a={getUser:function(){var e=i.defer(),r=e.promise,o=t.items.get("common","user");return o?e.resolve(o):n.getUser().then(function(n){n&&t.items.set("common","user",n),e.resolve(n)},function(){var t=CONFIGURATION.com.midea.isPcTest?CONFIGURATION.com.midea.userTest:{};e.resolve(t)}),r},setToken:function(e,t){var n=e.ssoToken||(CONFIGURATION.com.midea.isPcTest?CONFIGURATION.com.midea.userTest.ssoToken:"");return a.setHolderValue(t,CONFIGURATION.com.midea.ssoTokenPlaceholder,n),t},setLoginName:function(e,t){var n=e.uid||(CONFIGURATION.com.midea.isPcTest?CONFIGURATION.com.midea.userTest.uid:"");return a.setHolderValue(t,CONFIGURATION.com.midea.uidPlaceholder,n),t},setHolderValue:function(t,n,i){e.forEach(t,function(r,o){if(e.isObject(r))a.setHolderValue(r,n,i);else if(e.isString(r)&&r.indexOf(n)!==-1){var c=new RegExp(n,"g");t[o]=r.replace(c,i)}})},request:function(n,c,s){n=n||"",c=c||{},s=s||{};var u={},l=n,d=s.hasOwnProperty("baseUrl")?s.baseUrl:o.baseUrl,p=s.hasOwnProperty("keyExtend")?s.keyExtend:"",f=s.hasOwnProperty("urlParams")?s.urlParams:{},h=function(e,t,i,o){try{var a={};return a.err=1,a.key=n,a.params=c,a.msg=e,a.status=t,a.headers=i,a.config=o,r("_error",a),a}catch(e){return r("_error",e),e}};return o.isMock?l=o.mockPath+n+".json":l&&l.indexOf("http://")<0&&l.indexOf("https://")<0&&(l=d+o.methods[n]),l&&l.indexOf("http://")<0&&(window.jasmine||window.karma)&&(l="/base"+(0===l.indexOf("/")?l:"/"+l)),o.isMock||(l+=p,l+="?"+t.seriesParams(f)),u=o.isMock?e.extend(s,{method:"get"}):e.extend({method:"JSONP"},s),u.hasOwnProperty("keyExtend")&&delete u.keyExtend,u.hasOwnProperty("baseUrl")&&delete u.baseUrl,r("==================== request params ============="),r(d,l,p,c,u),a.getUser().then(function(r){if(c[CONFIGURATION.com.midea.ssoToken]=CONFIGURATION.com.midea.ssoTokenPlaceholder,a.setLoginName(r,c),a.setToken(r,c),"POST_FORMDATA"==u.method){var o=new FormData;for(var s in c)o.append(s,c[s]);return i.when(t.postJsonData(l,o,u)).then(function(e){return e.data},h)}return"POST_PAYLOAD"===u.method?(delete u.method,i.when(t.postFormDataByPayload(l,c,u)).then(function(e){return e.data},h)):"post"==u.method||"POST_JSON"==u.method?("POST_JSON"==u.method&&(c=JSON.stringify(c),u=e.extend({headers:{"Content-Type":"application/json;charset=UTF-8"}},u)),i.when(t.postJsonData(l,c,u)).then(function(e){return e.data},h)):"get"==u.method?i.when(t.getDataByGet(l,c,u)).then(function(e){return e.data},h):"json"==u.method?i.when(t.getJsonData(n,c,u)).then(function(e){return e.data},h):"JSONP"!==u.method?(c.url=l,e.extend(c,u),i.when(t.getData(c)).then(function(e){return e.data},h)):(e.extend(u,{customCallback:"jsonpcallback"}),i.when(t.getJsonPData(l,c,u)).then(function(e){return e.data},h))})},post:function(t,n,i){var r=i||{};return r=e.extend({method:"POST_JSON"},r),a.request(t,n,r)},get:function(t,n,i){var i=option||{};return i=e.extend({method:"get"},i),a.request(t,n,i)},jsonp:function(t,n,i){var i=option||{};return i=e.extend({method:"JSONP"},i),a.request(t,n,i)}};return a}]).factory("filterChar",function(){return function(e){if(!e)return"";for(var t,n,i="",r=0;r<e.length;r++){if(t=e.charCodeAt(r),console.log(t),n=0,t>=65281&&t<=65373)n=e.charCodeAt(r)-65248;else if(t>=19968&&t<=40869||t<=127){if(n=t,t<=127)switch(t){case 34:n=39;break;case 60:n=32;break;case 62:n=32;break;case 92:n=44}}else switch(t){case 8221:n=39;break;case 8220:n=39;break;case 12289:n=44;break;case 12290:n=46;break;case 8216:n=39;break;case 8217:n=39;break;default:n=32}i+=String.fromCharCode(n)}return i}}).factory("widgetFactory",["$q","log",function(t,n){var i="MideaCommon",r="MideaUser",o="MideaBarcode",a="MideaMap",c="MideaAnnto",s="MideaSale",u="MideaPdf",l={};return l={callApi:function(e,i,r){var o=t.defer();if(window.cordova)try{cordova.exec(function(e){o.resolve(e)},function(e){o.reject(e)},e,i,r||[])}catch(e){n("_error","widget error:",e),o.reject(e)}else n("_debug","Cordova is not exist"),o.reject("Cordova is not exist");return o.promise},password:function(){return l.callApi(i,"authPassword").then(e.noop,function(e){0===e?l.password():e===-1&&l.exit()})},showMenu:function(){return l.callApi(i,"showMenu",null)},showNav:function(){return l.callApi(i,"showNav",null)},hideNav:function(){return l.callApi(i,"hideNav",null)},exit:function(){return l.callApi(i,"exit",null)},goBack:function(){return l.callApi(i,"goBack",null)},shake:function(){return l.callApi(i,"shake",null)},shakeStop:function(){return l.callApi(i,"shakeStop",null)},showFloat:function(){return l.callApi(i,"showFloat",null)},hideFloat:function(){return l.callApi(i,"hideFloat",null)},language:function(){return l.callApi(i,"language",null)},getUser:function(){return l.callApi(r,"getUser",null)},getUserMap:function(){return l.callApi(r,"getUserMap",null)},scan:function(){return l.callApi(o,"scan",null)},scanNow:function(){return l.callApi(o,"scanNow",null)},getScanExtra:function(){return l.callApi(o,"getScanExtra",null)},location:function(e){return l.callApi(a,"location",e)},startUpdatingLocation:function(e){return l.callApi(a,"startUpdatingLocation",e)},stopUpdatingLocation:function(){return l.callApi(a,"stopUpdatingLocation",null)},navigation:function(e){return l.callApi(a,"navTo",e)},startOrder:function(e){return l.callApi(c,"startOrder",e)},stopOrder:function(e){return l.callApi(c,"stopOrder",e)},getPicture:function(e){var n=t.defer();try{navigator.camera.getPicture(function(e){n.resolve(e)},function(e){n.reject(e)},e)}catch(e){$log.error(e),n.reject()}return n.promise},getContact:function(e,n){var i=t.defer();try{navigator.service.contacts.find(e,function(e){i.resolve(e)},function(e){i.reject(e)},n)}catch(e){$log.error(e),i.reject(e)}return i.promise},orgChoose:function(){return l.callApi(r,"orgChoose",null)},orgMuChoose:function(e){return l.callApi(r,"orgMuChoose",e)},changeColor:function(e){return l.callApi(i,"statusBarColor",e)},logout:function(){return l.callApi(i,"logout",null)},webview:function(){return l.callApi(i,"webview",null)},screen:function(){return l.callApi(i,"screen",null)},getExtra:function(e){return l.callApi(i,"getExtra",e)},getDeviceInfo:function(){return l.callApi(i,"getDeviceInfo",null)},openUrl:function(e){return l.callApi(i,"openSysBrowser",[e])},statistics:function(e){return l.callApi(i,"onEvent",e)},share:function(e){return l.callApi(i,"share",e)},showAppView:function(){return l.callApi(i,"showAppView",["messageView"])},showPicker:function(n){var i=t.defer();return window.datePicker?(n=n||{},e.extend({date:new Date,mode:"date",type:"day"},n),datePicker.show(n,function(e){i.resolve(e)})):i.reject(),i.promise},getPhoneMan:function(){return l.callApi(r,"getContact",null)},goPersonalSet:function(){return l.callApi(i,"showSetView",null)},goMyView:function(){return l.callApi(i,"showMyView",null)},showWidget:function(e){return l.callApi(i,"showWidget",e)},showInput:function(){return l.callApi(i,"showInput",null)},hideInput:function(){return l.callApi(i,"hideInput",null)},showMessageView:function(){return l.callApi(i,"showAppView",["messageView"])},showFeedback:function(){return l.callApi(s,"showFeedback",null)},getBase64CodeFromPictures:function(e){return l.callApi(i,"getBase64s",e)},gotoSystemSetting:function(e){return l.callApi(i,"gotoSystemSetting",e)},showPdf:function(e){return l.callApi(u,"showPdf",e)},showTxt:function(e){return l.callApi(u,"showTxt",e)}}}]).factory("commonTools",["$q","$log",function(t,n){return{onClickOut:function(i){var r=t.defer();window._clickOutIds||(window._clickOutIds=0);var o="clickout."+window._clickOutIds;return window._clickOutIds+=1,i.attr("id",o),e.element(document).on("click."+o,function(t){var a=e.element(t.target);0===a.closest(i).length&&(r.resolve("click."+o),n.debug("click."+o))}),r.promise},offClickOut:function(t){e.isString(t)?e.element(document).off(t):e.element(document).off("click."+t.attr("id"))}}}]).factory("popupRight",["$ionicTemplateLoader","$compile","$rootScope",function(n,i,r){function o(o,a,u){u=u||!0;var l=this,d=e.element("[ui-view], ion-nav-view, .popup-right"),p=a&&a.$new()||r.$new(!0),f={duration:u?s?500:200:0,percent:0,easing:s?"cubic-bezier(0.36, 0.66, 0.04, 1)":"ease"};return l.element=null,n.load(o).then(function(n){l.element=i("<div class='popup-right'>"+n+"</div>")(p),e.element("body").append(l.element),t.animation(f).on("step",function(e){s?(l.element.css({zIndex:3,webkitTransform:"translate3d("+100*(1-e)+"%, 0, 0)"}),d.css({zIndex:0,opacity:1-.1*e,webkitTransform:"translate(-"+33*e+"%, 0)"})):(l.element.css({webkitTransform:"translate3d("+100*(1-e)+"%, 0, 0)"}),d.css({webkitTransform:"translate(-"+100*e+"%, 0)"}))}).start()}),l.close=function(e){e=e||!0,f.duration=e?f.duration:0,t.animation(f).on("step",function(e){s?(l.element.css({zIndex:3,webkitTransform:"translate("+100*e+"%, 0)"}),d.css({zIndex:0,opacity:.9+.1*e,webkitTransform:"translate(-"+33*(1-e)+"%, 0)"})):(l.element.css({webkitTransform:"translate3d("+100*e+"%, 0, 0)"}),d.css({webkitTransform:"translate(-"+100*(1-e)+"%, 0)"}))}).on("stop",function(){l&&(l.element.remove(),p.$destroy(),c.splice(c.indexOf(l),1))}).start()},l}function a(e,t,n){var i=new o(e,t,n);return c.push(i),i}var c=[],s=ionic.Platform.isIOS();return r.$on("$stateChangeStart",function(){e.forEach(c,function(e){e.close(!1)}),c=[]}),{show:a}}]).factory("$popView",["$ionicTemplateLoader","$compile","$rootScope","$q","log",function(n,i,r,o,a){function c(u){function l(){var e=ionic.Platform.isIOS();return"ios"===f.opts.animation||"default"===f.opts.animation&&e}function d(){return f.opts.direction===c.DIRECTION_LEFT||f.opts.direction===c.DIRECTION_RIGHT?l()?"cubic-bezier(0.36, 0.66, 0.04, 1)":"ease":"cubic-bezier(.76, .02, .14, 1)"}function p(e){return e.templateUrl?n.load(e.templateUrl):o.when(e.template)}this.opts=e.extend({},s,u),this.scope=this.opts.scope&&this.opts.scope.$new()||r.$new(!0),this.element=null;var f=this,h=e.element("[ui-view], [ion-nav-view], .pop-view"),A={duration:l()||f.opts.direction==c.DIRECTION_UP||f.opts.direction==c.DIRECTION_DOWN?500:200,easing:d()},g=f.opts.direction===c.DIRECTION_LEFT?-1:f.opts.direction===c.DIRECTION_RIGHT?1:0,m=f.opts.direction===c.DIRECTION_UP?1:f.opts.direction===c.DIRECTION_DOWN?-1:0,w=e.element("body"),T=w.css("background-color");this.animationIn=t.animation(A).on("step",function(e){if(f.element.css({webkitTransform:"translate3d("+100*g*(1-e)+"%, "+100*m*(1-e)+"%, 0)"}),f.opts.direction===c.DIRECTION_LEFT||f.opts.direction===c.DIRECTION_RIGHT)h.css({opacity:.7+.3*(1-e),webkitTransform:"translate(-"+33*g*e+"%, 0)"});else{var t=.7+.3*(1-e);h.css({opacity:.7+.3*(1-e),webkitTransform:"scale3d("+t+", "+t+", "+t+")"})}}),this.animationOut=t.animation(A).on("step",function(e){if(f.element.css({webkitTransform:"translate3d("+100*g*e+"%, "+100*m*e+"%, 0)"}),f.opts.direction===c.DIRECTION_LEFT||f.opts.direction===c.DIRECTION_RIGHT)h.css({opacity:.7+.3*e,webkitTransform:"translate(-"+33*g*(1-e)+"%, 0)"});else{var t=.7+.3*e;h.css({opacity:.7+.3*e,webkitTransform:"scale3d("+t+", "+t+", "+t+")"})}}).on("stop",function(){f.element.hide(),w.css("background-color",T)});var I=p(this.opts).then(function(e){f.tmpl=i('<div class="pop-view">'+e+"</div>"),f.element=f.tmpl(f.scope),f.element.css({position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:99,background:"#f2f2f2",webkitTransform:"translate3d("+100*g+"%, "+100*m+"%, 0)"}),f.element.appendTo("body")});this.shown=!1,this.show=function(t){function n(){return f.element?(f.element.show(),w.css("background-color","#000"),t?f.animationIn.restart():f.element.css({webkitTransform:"translate3d(0, 0, 0)"}),void(f.shown=!0)):void a("_error","This popView has been destroy.")}t=t!==!1,h=e.element("[ui-view], ion-nav-view"),I.then(function(){n()})},this.hide=function(t){var n=o.defer();return f.element?(t=t!==!1,h=e.element("[ui-view], ion-nav-view"),t?f.animationOut.restart().on("stop",function(){n.resolve()}):(f.element.css({webkitTransform:"translate3d("+100*g+"%, "+100*m+"%, 0)"}),n.resolve()),f.shown=!1,n.promise):void a("_error","This popView has been destroy.")},this.destroy=function(){return f.element?(f.element.remove(),f.element=null,void f.scope.$destroy()):void a("_error","This popView has been destroy.")}}var s={scope:null,direction:1,template:"请设定一个模板或者指定一个模板的路径",templateUrl:null,animation:"default"};return c.DIRECTION_UP=0,c.DIRECTION_RIGHT=1,c.DIRECTION_DOWN=2,c.DIRECTION_LEFT=3,c.PLATFORM_IOS="ios",c.PLATFORM_ANDROID="android",c}]).factory("$topTip",["$compile","$rootScope","$timeout","$q","$animate",function(t,n,i,r,o){return function(a,c){c=e.extend({timeout:3e3},c);var s=r.defer(),u=c.scope,l=u&&u.$new()||n.$new(!0),d=t('<div class="top-tip">'+a+"</div>")(l),p=window.devicePixelRatio||1;return d.appendTo("body"),d.css({marginTop:-d.height()/2,left:window.screen.width*p/2-(d.width()+2*d.offset().left+parseInt(d.css("padding-left"))+parseInt(d.css("padding-right"))+2*parseInt(d.css("border-width")))/2}),i(function(){o.leave(d).then(function(){d.remove(),s.resolve()})},c.timeout),s.promise}}]).factory("$transition",["$q","$timeout","$rootScope",function(t,n,i){function r(e){for(var t in e)if(void 0!==o.style[t])return e[t]}var o=document.createElement("trans"),a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},c={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"},s=function(r,o,a){a=a||{};var c=t.defer(),u=s[a.animation?"animationEndEventName":"transitionEndEventName"],l=function(){i.$apply(function(){r.unbind(u,l),c.resolve(r)})};return u&&r.bind(u,l),n(function(){e.isString(o)?r.addClass(o):e.isFunction(o)?o(r):e.isObject(o)&&r.css(o),u||c.resolve(r)}),c.promise.cancel=function(){u&&r.unbind(u,l),c.reject("Transition cancelled")},c.promise};return s.transitionEndEventName=r(a),s.animationEndEventName=r(c),s}]).factory("log",["$log",function(t){function n(e){var n=new Error,i=n.stack?n.stack.toString():"",r=[],o=3;if(i&&i.indexOf(" at ")>-1?r=i.replace(/(\n|\r)/g,"").split(" at "):i&&(i.indexOf("\n")>-1?(o=2,r=i.replace(/(\r)/g,"").split("\n")):(o=2,r=i.replace(/(\n)/g,"").split("\r"))),!i)return"";var a=r.length,c=r[a>o?o:a-1].replace(/(^\s*|\s*$)/g,"");return(e||CONFIGURATION.com.midea.isPrintStack)&&t.error(n.stack),c}return function(){var i=arguments;if(i){var r=i.length;if(0!==r){var o="string"==typeof i[r-1]&&"_stack"===i[r-1].toString().toLowerCase(),a="【 "+n(o)+" 】\n",c="string"==typeof i[0]?i[0].toString().toLowerCase():i[0],s="_debug"===c||"_info"===c||"_warn"===c||"_error"===c||"_log"===c,u=s?c.replace("_",""):"log",l=t[u],d=[a];e.forEach(i,function(e,t){s&&0===t||o&&t===r-1||d.push(e)}),d.push("\n\n"),l.apply(this,d)}}}}]).factory("popup",["$ionicPopup","baseService",function(t,n){return function(i,r,o){var r=r||{},a=r.defaultMsg||"温馨提示: 网络出错了, 请稍后再试!";i=i||a;var c={cssClass:"",title:"提示",template:i,okText:"确定",cancelText:"取消"};c=e.extend(c,r);var s=n.items,u="common";if(!s.get(u,"isTip")){var l;return s.set(u,"isTip",!0),"undefined"==typeof o||0===o?(l=t.alert(c),l.then(function(e){return s.set(u,"isTip",!1),e}),l):(l=t.confirm(c),l.then(function(e){return s.set(u,"isTip",!1),e}),l)}}}]).factory("tip",["popup",function(e){return function(t,n){return e(t,n,0)}}]).factory("tipConfirm",["popup",function(e){return function(t,n){return e(t,n,1)}}]).factory("statistics",["widgetFactory","log",function(e,t){return function(n,i){return t("statistics: ",n,i),e.statistics([{key:n,value:i}])}}]).factory("picture",["$rootScope","baseService","widgetFactory","$ionicActionSheet","log","tip","popupRight","$topTip","$q",function(t,n,i,r,o,a,c,s,u){var l="picture",d=n.items,p="data:image/jpeg;base64,",f="/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABQAAD/4QMpaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjAtYzA2MCA2MS4xMzQ3NzcsIDIwMTAvMDIvMTItMTc6MzI6MDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozMzM5RDY2ODMyNzQxMUU1QTJENkEwOTg5MjdGQTczNiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozMzM5RDY2OTMyNzQxMUU1QTJENkEwOTg5MjdGQTczNiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjMzMzlENjY2MzI3NDExRTVBMkQ2QTA5ODkyN0ZBNzM2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjMzMzlENjY3MzI3NDExRTVBMkQ2QTA5ODkyN0ZBNzM2Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQAAgICAgICAgICAgMCAgIDBAMCAgMEBQQEBAQEBQYFBQUFBQUGBgcHCAcHBgkJCgoJCQwMDAwMDAwMDAwMDAwMDAEDAwMFBAUJBgYJDQsJCw0PDg4ODg8PDAwMDAwPDwwMDAwMDA8MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM/8AAEQgAEAAQAwERAAIRAQMRAf/EAG8AAAMBAAAAAAAAAAAAAAAAAAQFBggBAAIDAAAAAAAAAAAAAAAAAAMEBQcIEAABBAEDBAMAAAAAAAAAAAABAgMEBQYAERIhMUEHYSIUEQACAgAGAgMBAAAAAAAAAAABAhEDACFREgQFMUFhoRQi/9oADAMBAAIRAxEAPwDWfripp7WwyFy7q13MWmoZtmzXIecYLr0ct8U82vsN+RGq06+pHZt67gqkxMZiNMaH73k3U11ip9hexV3QDAafRywd7BxuorKfDchrKaXjLmTtTVS8cmPl9TP5HUIQ8hTiUOcHgokch46EjronP46IldiqV3T/ACTMQfOsH5wHpOfdddfRY62CsrDqIncCSDBIlYzjXPCbBMsGHy76ehyUxNn0kuvq5UTYLZlPFBbcKipJSElPUjc/Gg8LlfnZmzkqQI9E4a7jrf3pWhAKrYrMD4KiZHg64mLW4tr2WqfdWcq1mrASqVLdW85xHZIUskgDwOw0tbc9rbnJJ+c8SHG4tXGTZUgVdAAB9Y//2Q==",h="https://www.baidu.com/img/bd_logo1.png",A="assets-library:// on iOS or content:// on Android",g=[{text:"拍照"},{text:"选择图片"}],m={takePicture:1,selectFile:2,both:0},w={THUMB_URL_AND_FILE_URI:-1,DATA_URL:0,FILE_URI:1,NATIVE_URI:2},T={isShowBtns:!1,tpl:!1,btnsTpl:!1};d.set(l,"pictures",[]),d.set(l,"targetWidth",0),d.set(l,"targetHeight",0),d.set(l,"popup",!1),d.set(l,"bigPicture",!1),d.set(l,"showPictureView",!1),CONFIGURATION.com.midea.isPcTest&&(window.Camera={},Camera.DestinationType={THUMB_URL_AND_FILE_URI:-1,DATA_URL:0,FILE_URI:1,NATIVE_URI:2},Camera.PictureSourceType={PHOTOLIBRARY:0,CAMERA:1,SAVEDPHOTOALBUM:2},Camera.EncodingType={JPEG:0,PNG:1},Camera.MediaType={PICTURE:0,VIDEO:1,ALLMEDIA:2},Camera.Direction={BACK:0,FRONT:1});var I=function(e){var t=d.get(l,"pictures")||[];if(e){var n=t.length;return n>0&&t[n-1]}return t},v=function(e){d.set(l,"pictures",e)},O=function(e,t){var n=e?[]:I();n.push(t),v(n)},b=function(){var t=d.get(l,"bigPicture")||!1;if(t){var n=I(),i=!1;return e.forEach(n,function(e,n){if(e.imgId===t)return void(i=e)}),i}return!1},P=function(e){d.set(l,"bigPicture",e.imgId)},y=function(){var e=b();return e?e.getOriginSrc():""},E=function(){return d.get(l,"pictureParams")||T},D=function(e){e=e||T,d.set(l,"pictureParams",e)},R=function(e,n){var i=n||{},r=i.pageTpl||"lib/template/pictureView.html",o=i.isShowBtns||!1,a=i.tpl||!1,s=i.btnsTpl||!1,u=i.isNewScope||!1,p=i.delFeedback||!1,f=i.closeFeedback||!1;D({isShowBtns:o,tpl:a,btnsTpl:s,delFeedback:p,closeFeedback:f}),P(e);var h=u?t.$new(!0):t;h.getPictureParams=function(){return E()},h.getBigPictureSrc=function(){return y()},d.set(l,"showPictureView",c.show(r,h))},N=function(e){var t=d.get(l,"showPictureView");t&&t.close();var n=E(),i=n.closeFeedback;e?e():i&&i(),D(),P(!1)},k=function(t,n,i,r){var o=[],a=I(),c=b();t||0===t?e.forEach(a,function(e,n){e.imgId!==a[t].imgId&&o.push(e)}):e.forEach(a,function(e,t){c&&e.imgId===c.imgId||o.push(e)}),v(o);var s=E(),u=s.delFeedback;i?i():u&&u(),n||N(r)},C=function(e,t){t=t||{};var n=t.isSingle||!1,i=t.feedback||!1,r=!t.hasOwnProperty("isUpload")||t.isUpload,o=!!t.hasOwnProperty("isSrc")&&t.isSrc,a=t.hasOwnProperty("destinationType")?t.destinationType:w.THUMB_URL_AND_FILE_URI;if(e){var c="";a===w.THUMB_URL_AND_FILE_URI&&(c=e.hasOwnProperty("origin")?e.origin:"",e=e.hasOwnProperty("thumbnail")?e.thumbnail:e),o=0===e.indexOf("file:///")||0===e.indexOf("http://")||0===e.indexOf("https://");var u={};u.imgId=(new Date).getTime()+Math.floor(1e7*Math.random()),o?u.src=e:(u.fileBt64=e,u.prefixBt64=p),u.originSrc=c,u.getBase64Code=function(e){return e?L(this.fileBt64):this.fileBt64},u.getSrc=function(){return"undefined"!=typeof this.src?this.src:this.prefixBt64+this.fileBt64},u.getOriginSrc=function(){return this.originSrc?this.originSrc:this.getSrc()},u.upload=r,O(n,u),i&&i()}else s("照片已损坏, 请重试!",{title:""})},M=function(e,t){t=t||{};var n=t.hasOwnProperty("quality")?t.quality:75,r=!!t.hasOwnProperty("allowEdit")&&t.allowEdit,a=!!t.hasOwnProperty("saveToPhotoAlbum")&&t.saveToPhotoAlbum,c=t.hasOwnProperty("destinationType")?t.destinationType:w.THUMB_URL_AND_FILE_URI,u=d.get(l,"popup");u&&(d.set(l,"popup",!1),u()),CONFIGURATION.com.midea.isPcTest?c===w.FILE_URI||c===w.THUMB_URL_AND_FILE_URI?C(h,t):c===w.NATIVE_URI?C(A,t):C(f,t):i.getPicture({quality:n,destinationType:c,allowEdit:r,encodingType:Camera.EncodingType.JPEG,targetWidth:d.get(l,"targetWidth"),targetHeight:d.get(l,"targetHeight"),saveToPhotoAlbum:a,sourceType:e,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0,cameraDirection:Camera.Direction.BACK}).then(function(e){C(e,t)},function(e){o(e),s("您已取消拍照!",{title:""})})},S=function(e,t){if(!d.get(l,"targetWidth")||!d.get(l,"targetHeight")){var n=t.hasOwnProperty("widthRate")?t.widthRate:1,r=t.hasOwnProperty("heightRate")?t.heightRate:1,a=t.hasOwnProperty("width")?t.width:window.screen&&window.screen.width?window.screen.width:360,c=t.hasOwnProperty("height")?t.height:window.screen&&window.screen.height?window.screen.height:640,s=t.hasOwnProperty("maxWidth")?t.maxWidth:720,u=t.hasOwnProperty("maxHeight")?t.maxHeight:1280;a=parseInt(a*n),c=parseInt(c*r),a=s===!1?a:Math.min(s,a),c=u===!1?c:Math.min(u,c),o(window.screen),o(n),o(r),o(s),o(u),o(c),o(a),i.webview().then(function(i){i&&i.webviewWidth&&i.webviewHeigh?(a=parseInt(i.webviewWidth*n),c=parseInt(i.webviewHeigh*r),a=s===!1?a:Math.min(s,a),c=u===!1?c:Math.min(u,c),d.set(l,"targetWidth",a),d.set(l,"targetHeight",c),e&&U(t)):(d.set(l,"targetWidth",a),d.set(l,"targetHeight",c),o("获取屏幕大小失败, 请重试!"),e&&U(t))},function(n){d.set(l,"targetWidth",a),d.set(l,"targetHeight",c),o("获取屏幕大小失败, 请重试!"),e&&U(t)})}},U=function(e){var t=e||{},n=t.isSingle||!1,i=n?1:t.maxNum||9999,o=t.feedback||!1,a=t.buttonsType||m.both,c=t.buttons||!1,u=t.noneSelect||!1,p=t.onClick||!1,f=t.cancelText||!1,h=t.hasOwnProperty("quality")?t.quality:75,A=!!t.hasOwnProperty("allowEdit")&&t.allowEdit,T=!!t.hasOwnProperty("saveToPhotoAlbum")&&t.saveToPhotoAlbum,v=t.hasOwnProperty("widthRate")?t.widthRate:1,O=t.hasOwnProperty("heightRate")?t.heightRate:1,b=!!t.hasOwnProperty("width")&&t.width,P=!!t.hasOwnProperty("height")&&t.height,y=t.hasOwnProperty("maxWidth")?t.maxWidth:720,E=t.hasOwnProperty("maxHeight")?t.maxHeight:1280,D=t.hasOwnProperty("destinationType")?t.destinationType:w.THUMB_URL_AND_FILE_URI;f=f===!1?"取消":f,i||(i=99),n||1!==i||(n=!0);var R={isSingle:n,maxNum:i,feedback:o,buttonsType:a,buttons:c,onClick:p,cancelText:f,quality:h,allowEdit:A,saveToPhotoAlbum:T,noneSelect:u,widthRate:v,heightRate:O,destinationType:D,width:b,height:P,maxWidth:y,maxHeight:E},N=I(),k=N.length;if(k>0&&!n&&k>i-1)s("最多"+i+"张图片",{title:""});else if(CONFIGURATION.com.midea.isPcTest||d.get(l,"targetWidth")&&d.get(l,"targetHeight")){var C=c;if(c||(c=[],a==m.takePicture?c.push(g[0]):a==m.selectFile?c.push(g[1]):(c.push(g[0]),c.push(g[1]))),p||(p=function(e){a==m.takePicture?M(Camera.PictureSourceType.CAMERA,R):a==m.selectFile?M(Camera.PictureSourceType.SAVEDPHOTOALBUM,R):0===e?M(Camera.PictureSourceType.CAMERA,R):1===e?M(Camera.PictureSourceType.SAVEDPHOTOALBUM,R):2===e&&M(Camera.PictureSourceType.PHOTOLIBRARY,R)}),!C&&u&&a!=m.both)a==m.takePicture?M(Camera.PictureSourceType.CAMERA,R):a==m.selectFile&&M(Camera.PictureSourceType.SAVEDPHOTOALBUM,R);else{var U=r.show({buttons:c,cancelText:f,buttonClicked:function(e){p(e)}});d.set(l,"popup",U)}}else S(!0,e)},_=function(e,t,n){n?U(n):e?U({isSingle:!0,allowEdit:!0}):t||0===t?U({maxNum:t,saveToPhotoAlbum:!0}):U()},B=function(e,t){var n=t||{pageTpl:!1,isShowBtns:!0,tpl:!1,btnsTpl:!1,isNewScope:!0};R(e,n)},F=function(){v([])},x=function(t,n){var r=u.defer(),o=r.promise,a="undefined"!=typeof t&&e.isArray(t);if(t=t||[],a||(t=[],e.forEach(I(),function(e,n){t.push(e.getOriginSrc())})),0===t.length)n&&n([]),r.resolve([]);else if(CONFIGURATION.com.midea.isPcTest){var c=[];e.forEach(t,function(e,t){c.push(f)}),n&&n(c),r.resolve(c)}else i.getBase64CodeFromPictures(t).then(function(e){e&&e.base64?(n&&n(e.base64),r.resolve(e.base64)):(s("图片转换为base64 失败",{title:""}),r.reject())},function(){s("图片转换为 base64失败",{title:""}),r.reject()});return o},L=function(e){return e?e.replace(/\+/g,"%2B"):""};return{selectPicture:U,takePhoto:_,showPicture:R,showPhoto:B,getPictures:I,setPictures:v,addPicture:O,webview:S,addImage:C,getPicture:M,closePicture:N,delPicture:k,getBigPicture:b,setBigPicture:P,getBigPictureSrc:y,getPictureParams:E,setPictureParams:D,buttonsTypes:m,imgPackageHeader:p,imgDefaultBase64Code:f,imgDefaultFileUrl:h,imgDefaultNativeUrl:A,destinationTypes:w,clearPictures:F,getBase64Codes:x,urlEncodeForBase64Code:L}}])}),t[""]=e}({},function(){return this}());